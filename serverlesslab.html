<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
</head>



<p class=MsoTocHeading>Table of Contents</p>

<p class=MsoToc1><a href="#_Toc502863953">Overview<span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></p>

<p class=MsoToc1><a href="#_Toc502863954">Introduction<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc1><a href="#_Toc502863955">Launching a development toolchain
using AWS CodeStar<span style='color:windowtext;display:none;text-decoration:
none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc1><a href="#_Toc502863956">Writing your first AWS Lambda
Function on AWS Cloud9<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></p>

<p class=MsoToc1><a href="#_Toc502863957">Deploying Your Function using AWS SAM
and AWS CodeDeploy<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></p>

<p class=MsoToc1><a href="#_Toc502863958">Debugging and Monitoring your
function<span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>14</span></a></p>

<p class=MsoToc1><a href="#_Toc502863959">Clean up<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></p>

<p class=MsoToc1><a href="#_Toc502863960">Conclusion<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></p>



<h1><a name="_Toc502863953">Overview</a></h1>

<p class=MsoNormal>With services like AWS CodeStar, AWS Cloud9, AWS Lambda and
Amazon API Gateway, developers can very easily develop, debug, and deploy
serverless applications in the cloud.</p>

<p class=MsoNormal>AWS CodeStar enables you to quickly develop, build, and
deploy applications on AWS. AWS CodeStar provides a unified user interface,
enabling you to easily manage your software development activities in one
place. With AWS CodeStar, you can set up your entire&nbsp;continuous
delivery&nbsp;toolchain in minutes, allowing you to start releasing code
faster.&nbsp;</p>

<p class=MsoNormal>AWS Cloud9 is a cloud-based integrated development
environment (IDE) that lets you write, run, and debug your code with just a
browser. It includes a code editor, debugger, and terminal. With Cloud9, you
can quickly share your development environment with your team, allowing you to
pair program and track each other's inputs in real-time.</p>

<p class=MsoNormal>AWS Lambda lets you run code without provisioning or
managing servers. You pay only for the compute time you consume - there is no
charge when your code is not running. With Lambda, you can run code for
virtually any type of application or backend service - all with zero
administration. Just upload your code and Lambda takes care of everything
required to run and scale your code with high availability.&nbsp;</p>

<p class=MsoNormal>In this Lab, you will experience:</p>

<p class=MsoListParagraph style='margin-top:0in;margin-right:0in;margin-bottom:
6.0pt;margin-left:.5in'><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
dir=LTR></span>Launching development tools for building a serverless
application using AWS CodeStar.</p>

<p class=MsoListParagraph style='margin-top:0in;margin-right:0in;margin-bottom:
6.0pt;margin-left:.5in'><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
dir=LTR></span>Developing your first AWS Lambda function.</p>

<p class=MsoListParagraph style='margin-top:0in;margin-right:0in;margin-bottom:
6.0pt;margin-left:.5in'><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
dir=LTR></span>Deploying your first AWS Lambda function using AWS SAM (<span
class=col-11>Serverless Application Model)</span>.</p>

<p class=MsoListParagraph style='margin-top:0in;margin-right:0in;margin-bottom:
6.0pt;margin-left:.5in'><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
dir=LTR></span>Testing and debugging your AWS Lambda function in AWS Cloud9 and
AWS SAM Local.</p>

<p class=MsoNormal><a name="_Toc283052598"></a><a name="_Toc369617343"><b>Important:
</b>Many of the steps in this lab involve resolving errors that have been built
in to the provided starter files (in step </a>17). This approach will show how
the IDE can be used to develop, test and deploy serverless applications.</p>



<h1><a name="_Toc502863954">Introduction</a></h1>

<p class=MsoNormal>In this hands-on lab, we are going to start with a Hello
World node.js serverless app that returns a static web page. As part of this
lab, we will be developing, testing, debugging and deploying a new serverless
function for adding 2 numbers. The high level architecture is as follows:</p>

<p class=MsoNormal align=center style='text-align:center'></p>

<h1><a name="_Toc502863955">Launching a development toolchain using AWS
CodeStar</a></h1>

<p class=InstructionStep><span style='color:black'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Sign into the AWS Management Console <a
href="https://console.aws.amazon.com/">https://console.aws.amazon.com/</a>. <br>
<br>
<b>Note: </b>For this lab you will need to use an IAM user and not a federated
user account. The account will require <i>AWSCodeStarFullAccess</i> managed
policy. Alternatively, you can create projects if you have an IAM
administrative user with full permissions for all AWS Services (<i>AdministratorAccess</i>
managed policy). For more information, see<a
href="https://docs.aws.amazon.com/codestar/latest/userguide/setting-up.html#setting-up-create-iam-user">
Setting up AWS Code Star (Step 3: Create or Use an IAM User).</a> </p>

<p class=InstructionStep><span style='color:black'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>In the upper-right corner of the AWS
Management Console, confirm you are in the desired AWS region (e.g., N.
Virginia).</p>

<p class=InstructionStep><span style='color:black'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Click on <b>AWS CodeStar</b> from the list
of all services.  </p>

<p class=InstructionStep><span style='color:black'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Click on <b>Start a project</b>.</p>

<p class=InstructionStep><span style='color:black'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>If this is the first time you use the
service, you will be prompted to create the required service roles for AWS Code
* services. Select <b>Yes, create role</b>.</p>

<p class=InstructionStep align=center style='margin-left:.25in;text-align:center;
text-indent:0in'>&nbsp;</p>

<p class=InstructionStep style='margin-left:22.3pt;text-indent:-22.3pt;
page-break-before:always'><span style='color:black'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Choose a project template:<b><br>
</b>Under <i>Application Category</i> select <i>Web Application.</i><b><br>
</b>Under <i>Programming Languages</i> select <i>Node.js.</i><br>
Pick <i>Node.JS Web Application AWS Lambda (running serverless).</i></p>

<p class=InstructionStep align=center style='margin-left:.25in;text-align:center;
text-indent:0in'></p>

<p class=InstructionStep><span style='color:black'>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Enter the project details:<br>
Project name: <i>serverless-lab.<br>
</i>Which repository do you want to use?<i> AWS CodeCommit.</i><br>
Click <b>Next</b>.</p>

<p class=InstructionStep align=center style='text-align:center;text-indent:
0in'></p>

<p class=InstructionStep><span style='color:black'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>Leave everything as the default and click on
<b>Create Project</b>. If this is the first time you use the service, you will also
be prompted to enter your display name and email.</p>

<p class=InstructionStep><span style='color:black'>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span dir=LTR></span>We are going to use AWS Cloud9 as our IDE.
Select AWS Cloud9 and hit <b>Next.</b></p>

<p class=InstructionStep><span style='color:black'>10.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>For our instance, we will select <i>t2.small</i>.
We will leave the networking settings as default which will launch the instance
in our default VPC in a public subnet. Under <i>Cost-saving</i> settings,
observe that the environment will be automatically shut down after 30 minutes.
Click <b>Next</b>.</p>

<p class=InstructionStep><span style='color:black'>11.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>AWS CodeStar is now provisioning all the AWS
Code * services. This process may take around 3-5 minutes.</p>

<p class=InstructionStep align=center style='margin-left:0in;text-align:center;
text-indent:0in'></p>

<p class=InstructionStep><span style='color:black'>12.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>While you wait, open up a new browser tab
and go to the <a
href="https://console.aws.amazon.com/iam/home?region=us-east-1#/roles">IAM
Roles console</a> (listed under Services). Search for <i>‘code’</i> and notice
that AWS CodeStar created new IAM Roles for each of the AWS service we are
going to use. </p>

<p class=InstructionStep><span style='color:black'>13.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Head back to the <i>AWS CodeStar Dashboard</i>
and scroll to the <i>Application endpoints</i> panel. <br>
<br>
</p>

14.<span
style='font:7.0pt "Times New Roman"'> </span></span><span dir=LTR></span>Click
on the endpoint URL. You should see a “Hello World” web page rendered by
Node.js. Congratulations! You successfully configured an end-to-end development
and continuous deployment pipeline on AWS.</p>

<h1><a name="_Toc502863956">Writing your first AWS Lambda Function on AWS
Cloud9</a></h1>

<p class=InstructionStep><span style='color:black'>15.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Go back to the AWS CodeStar dashboard, and click
on <b>IDE</b> on the left pane. <br>
Click <b>Open IDE.</b></p>

<p class=InstructionStep align=center style='margin-left:.25in;text-align:center;
text-indent:0in'></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='margin-left:22.5pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=222 valign=top style='width:166.8pt;border:solid #BFBFBF 1.0pt;
  border-right:none;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p class=InstructionStep style='margin-left:0in;text-indent:0in'><b>Note:</b></p>
  <p class=InstructionStep align=center style='margin-left:0in;text-align:center;
  text-indent:0in'></p>
  </td>
  <td width=419 valign=top style='width:314.2pt;border:solid #BFBFBF 1.0pt;
  border-left:none;padding:5.75pt 5.75pt 5.75pt 5.75pt'>
  <p class=InstructionStep style='margin-left:0in;text-indent:0in'><br>
  <br>
  You use the AWS Cloud9 IDE, running in a web browser on your local computer,
  to interact with your environment. An Amazon EC2 instance or your own server
  connects to the environment. An environment is a place where you store your
  project's files and where you run the tools to develop your apps.</p>
  <p class=InstructionStep style='margin-left:0in;text-indent:0in'>You use the
  AWS Cloud9 IDE to work with files in the environment. You can:</p>
  <p class=InstructionStep style='margin-left:.5in;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span>Store these files locally on the instance
  or server.</p>
  <p class=InstructionStep style='margin-left:.5in;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span>Clone a remote code repository—such as a
  repo in AWS CodeCommit—into your environment.</p>
  <p class=InstructionStep style='margin-left:.5in;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span>Work with a combination of local and
  cloned files in the environment.</p>
  </td>
 </tr>
</table>

<p class=InstructionStep style='margin-left:.25in;text-indent:0in'>&nbsp;</p>

<p class=InstructionStep><span style='color:black'>16.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Upon first login, AWS Cloud9 automatically
clone a starter project “locally” into our development instance. You should see
something like this:</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='margin-left:27.7pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=636 valign=top style='width:477.0pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=Code><span style='font-size:11.0pt;color:#9BBB59'>user</span><span
  style='font-size:11.0pt'>:<span style='color:#4BACC6'>~/environment</span> $
  /tmp/git-cloning-runner-xxx-xxx.sh</span></p>
  <p class=Code><span style='font-size:11.0pt'>Cloning into '/home/ec2-user/environment/serverless-lab'...</span></p>
  <p class=Code><span style='font-size:11.0pt'>remote: Counting objects: 16,
  done.</span></p>
  <p class=Code><span style='font-size:11.0pt'>Unpacking objects: 100% (16/16),
  done.</span></p>
  <p class=Code><span style='font-size:11.0pt'>&nbsp;</span></p>
  <p class=Code><span style='font-size:11.0pt'>Navigate to your cloned
  repository by typing &quot;cd /home/ec2-user/environment/serverless-lab&quot;
  to start working with &quot;https://git-codecommit.us-east-1.amazonaws.com/v1/repos/serverless-lab&quot;</span></p>
  <p class=Code><span style='font-size:11.0pt'>&nbsp;</span></p>
  <p class=Code><span style='font-size:11.0pt'>To set your display name run
  &quot;git config --global user.name YOUR_USER_NAME&quot;</span></p>
  <p class=Code><span style='font-size:11.0pt'>To set your display email run
  &quot;git config --global user.email YOUR_EMAIL_ADDRESS&quot;</span></p>
  <p class=Code><span style='font-size:11.0pt'>&nbsp;</span></p>
  <p class=Code><span style='font-size:11.0pt;color:#9BBB59'>user</span><span
  style='font-size:11.0pt'>:<span style='color:#4BACC6'>~/environment</span> $</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='line-height:115%'>&nbsp;</span></p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><a name="_Ref502827008"><span style='line-height:115%'>&nbsp;</span></a></p>

<p class=InstructionStep><span style='color:black'>17.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>We’re going to create a new API microservice
in this project. Perform the following command in the terminal window at the
bottom (labeled as <i>bash – “ip-xx-xx-xx-xx”):</i><br>
<br>
<span style='font-family:"Andale Mono"'>cd serverless-lab<br>
wget </span><a
href="https://s3-us-west-2.amazonaws.com/apn-bootcamps/serverless-2018/addservice-01.tar.gz"><span
style='font-family:"Andale Mono"'>https://s3-us-west-2.amazonaws.com/apn-bootcamps/serverless-2018/addservice-01.tar.gz</span></a><span
style='font-family:"Andale Mono"'><br>
tar xf addservice-01.tar.gz<br>
rm addservice-01.tar.gz</span></p>

<p class=InstructionStep style='text-indent:0in'><b>Note:</b> In some browsers
(E.g. Google Chrome), you may be prompted to download Cloud9 Browser Extension
to enable copy-paste between this document, and the AWS Cloud9 IDE inside the
browser window.</p>

<p class=InstructionStep align=center style='text-align:center;text-indent:
0in'></p>

<p class=InstructionStep style='text-indent:0in'>The commands above will add
the following files to your local AWS Cloud9 environment: </p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span><span dir=LTR></span><span
style='font-family:"Andale Mono"'>add.js</span> – our addition-as-a-service
lambda function</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span><span dir=LTR></span><span
style='font-family:"Andale Mono"'>test/event.numbers.json</span> – the test
payload</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
dir=LTR></span><span style='font-family:"Andale Mono"'>.gitignore</span> –
instruction for git to ignore temp files</p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><span style='line-height:115%'>&nbsp;</span></p>

<p class=InstructionStep style='text-indent:0in'>To confirm we have all the
files in place, perform <span style='font-family:"Andale Mono"'>ls</span> in
the terminal window and you should see the following files:</p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='margin-left:22.5pt;border-collapse:collapse;border:none'>
 <tr style='height:1.45in'>
  <td width=336 valign=top style='width:251.75pt;padding:0in 5.4pt 0in 5.4pt;
  height:1.45in'>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>add.js</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>buildspec.yml</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>index.js</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>\nothing</span></p>
  </td>
  <td width=336 valign=top style='width:251.75pt;padding:0in 5.4pt 0in 5.4pt;
  height:1.45in'>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>\public</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>README.md</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>template.yml</span></p>
  <p class=InstructionStep style='margin-left:58.5pt;text-indent:-.25in'><span
  style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span></span><span dir=LTR></span><span style='font-family:"Andale Mono"'>\test</span></p>
  </td>
 </tr>
</table>

<p class=InstructionStep><span style='color:black'>18.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>We will need to update our SAM template (<i>template.yml</i>)
to register our new function. <br>
Incorporate these **<b>requirements**</b> by modifying the template.yml file:</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span><span dir=LTR></span>Function
name: “<span style='font-family:"Andale Mono"'>AddService</span>” </p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><span
style='font-family:"Andale Mono"'>b.<span style='font:7.0pt "Times New Roman"'>
</span></span><span dir=LTR></span>The functionality will be handled by the <span
style='font-family:"Andale Mono"'>handler() </span>function in <span
style='font-family:"Andale Mono"'>add.js</span></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
dir=LTR></span>Runtime: “<span style='font-family:"Andale Mono"'>nodejs6.10</span>”
</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>d.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span><span dir=LTR></span>Use
the same <span style='font-family:"Andale Mono"'>LambdaTrustRole</span></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>e.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span><span dir=LTR></span>The
event trigger will be coming from our existing “<span style='font-family:"Andale Mono"'>GetEvent</span>”
API Gateway</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'>f.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
dir=LTR></span>We would like to return a JSON response whenever we receive an <i>ANY</i>
HTTP request to the API with path <span style='font-family:"Andale Mono"'>/add/{x}/{y</span>}.
Therefore, given <a href="http://[api-address]/add/1/2"><span style='font-family:
"Andale Mono"'>http://[api-address]/add/1/2</span></a><span style='font-family:
"Andale Mono"'>,</span>the API should return <span style='font-family:"Andale Mono"'>{
… “result”:3 … }</span>.  </p>

<p class=MsoCommentText><b>Hint: </b>Use the <i>GetHelloWorld</i> resource
definition in the same file (template.yml) to help you apply the necessary
changes.  See <a
href="http://docs.aws.amazon.com/lambda/latest/dg/serverless_app.html">Serverless
Resources Within AWS SAM</a> for the complete reference, or use the guide
below:</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=671 valign=top style='width:503.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=Code><span style='font-size:10.0pt;color:red'><br>
  AddService</span><span style='font-size:10.0pt'>:</span></p>
  <p class=Code><span style='font-size:10.0pt'>  Type:
  AWS::Serverless::Function</span></p>
  <p class=Code><span style='font-size:10.0pt'>  Properties:</span></p>
  <p class=Code><span style='font-size:10.0pt'>    Handler: <span
  style='color:red'>filename</span>.<span style='color:red'>handler-function</span></span></p>
  <p class=Code><span style='font-size:10.0pt'>    Runtime: <span
  style='color:red'>nodejs6.10</span></span></p>
  <p class=Code><span style='font-size:10.0pt'>    Role:</span></p>
  <p class=Code><span style='font-size:10.0pt'>      Fn::ImportValue:</span></p>
  <p class=Code><span style='font-size:10.0pt'>        !Join ['-', [!Ref
  'ProjectId', !Ref 'AWS::Region', 'LambdaTrustRole']]</span></p>
  <p class=Code><span style='font-size:10.0pt'>    Events:</span></p>
  <p class=Code><span style='font-size:10.0pt'>      <span style='color:red'>GetEvent</span>:</span></p>
  <p class=Code><span style='font-size:10.0pt'>        Type: <span
  style='color:red'>Api</span></span></p>
  <p class=Code><span style='font-size:10.0pt'>        Properties:</span></p>
  <p class=Code><span style='font-size:10.0pt'>          Path: <span
  style='color:red'>/path/{x}/{y}</span></span></p>
  <p class=Code><span style='font-size:10.0pt'>          Method: <span
  style='color:red'>any<br>
  <br>
  </span></span></p>
  </td>
 </tr>
</table>

<p class=MsoCommentText><br>
<br>
</p>

<p class=InstructionStep><span style='color:black'>19.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>After you are done making those changes. Let’s
test our resource definition locally in our Cloud9 environment to make sure we
have defined our new AWS Lambda function correctly. In the terminal window,
confirm that you are in<br>
<span style='font-family:"Andale Mono"'>/home/ec2-user/environment/serverless-lab/</span>
and perform the following:<br>
<br>
<span style='font-family:"Andale Mono"'>sam local invoke &quot;AddService&quot;
-e test/event.numbers.json</span></p>

<p class=MsoNormal style='margin-left:22.5pt'>Our <span style='font-family:
"Andale Mono"'>add.js</span> currently do not implement the functionality we
are seeking. We are expecting to see <span style='font-family:"Andale Mono"'>“Error:
Not Implemented” </span>exception<span style='font-family:"Andale Mono"'>.</span>
This means we have configured our SAM template correctly.</p>

<p class=MsoNormal style='margin-left:22.5pt'><b>Note: </b>The first time you
execute a function, SAM LOCAL will fetch the appropriate Docker image for the
function as defined in our template.yml. Once that is done, SAM LOCAL will
invoke the<span style='font-size:11.0pt;line-height:115%'> </span>Lambda
function we just wrote, showed the response, <i>Duration</i> and the <i>Max Memory
Used</i> metric which is useful for tuning our AWS Lambda function
configuration.</p>

<p class=InstructionStep><span style='color:black'>20.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Open up <i>add.js</i> and implement our add
function in line 12-16.</p>

<p class=InstructionStep align=center style='text-align:center;text-indent:
0in'></p>

<p class=InstructionStep><span style='color:black'>21.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>You think you got it right? Let’s test out
the Lambda function locally again:<br>
<br>
<span style='font-family:"Andale Mono"'>sam local invoke &quot;AddService&quot;
-e test/event.numbers.json <br>
</span><br>
should return the following:<span style='font-family:"Andale Mono"'> </span></p>

<p class=InstructionStep style='text-indent:0in'><span style='font-family:"Andale Mono"'>{<br>
    &quot;statusCode&quot;:200,<br>
    <b>&quot;body&quot;:&quot;{\&quot;result\&quot;:116}&quot;,</b><br>
    &quot;headers&quot;:{&quot;Content-Type&quot;:&quot;application/json, … }<br>
}</span></p>

<p class=InstructionStep><span style='color:black'>22.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Congratulations! You have implemented <span
style='font-family:"Andale Mono"'>add()</span>as an AWS Lambda function.</p>

<h1><a name="_Toc502863957">Deploying Your Function using AWS SAM and AWS
CodeDeploy</a></h1>

<p class=InstructionStep><span style='color:black'>23.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>We will now configure our git user in the AWS
Cloud9 environment so we can commit our changes to the code repository<br>
<br>
<span style='font-family:"Andale Mono"'>git config --global user.email </span><a
href="mailto:you@example.com"><span style='font-family:"Andale Mono"'>you@example.com</span></a><span
style='font-family:"Andale Mono"'><br>
git config --global user.name &quot;Your Name&quot;</span><br>
<br>
</p>

<p class=InstructionStep><span style='color:black'>24.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>We are going to add all our pending changes,
commit it to Git and push it to our AWS CodeCommit Repository:<br>
<br>
<span style='font-family:"Andale Mono"'>git add -A<br>
git commit -m &quot;add add-as-a-service&quot;<br>
git push origin master</span><br>
<br>
</p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><span style='line-height:115%'>&nbsp;</span></p>

<p class=InstructionStep><span style='color:black'>25.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>By default, AWS CodeStar configured AWS CodeBuild
to deploy on every code commits. Go back to your AWS CodeStar serverless-lab
dashboard. You can see the status of the current build, or see more details
about the build by selecting <b>Build</b> from the left hand pane. You will notice
that a build is currently taking place. This will take around 2 minutes.</p>

<p class=InstructionStep align=center style='text-align:center;text-indent:
0in'></p>

<p class=MsoNormal style='margin-left:22.5pt'><b>Note: </b>You can also deploy the
AWS Lambda function manually, by executing the following commands. You will
need to provide S3 bucket location, CloudFormation Stack name and other
parameters that the CloudFormation requires.</p>

<p class=MsoNormal style='text-indent:22.5pt'>To create the package on an S3
Bucket:</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='margin-left:27.7pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=649 valign=top style='width:487.1pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=Code><br>
  <span style='font-size:11.0pt'>aws cloudformation package <span
  style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --template-file
  ./template.yml <span style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --s3-bucket <span
  style='color:#4BACC6'>$S3_BUCKET </span><span style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --s3-prefix <span
  style='color:#4BACC6'>$S3_BUCKET_PREFIX_NAME</span> <span style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --output-template-file
  ./template.output.yml <span style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --force-upload </span><br>
  <br>
  </p>
  </td>
 </tr>
</table>

<p class=InstructionStep style='margin-left:.25in;text-indent:0in'>&nbsp;</p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='text-indent:22.5pt'>To execute the deployment:</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='margin-left:27.7pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=649 valign=top style='width:487.1pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=Code><br>
  <span style='font-size:11.0pt'>aws cloudformation deploy <span
  style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --template-file ./template.output.yml
  <span style='color:#8080FF'>\</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --stack-name <span
  style='color:#6089B4'>$STACK_NAME </span><span style='color:#8080FF'>\ </span><span
  style='color:#8064A2'># E.g. serverless-lab</span></span></p>
  <p class=Code><span style='font-size:11.0pt'>    --capabilities CAPABILITY_IAM<br>
      --parameter-overrides ProjectId<span style='color:#4BACC6'>=$PROJECT_ID </span><span
  style='color:#8064A2'># E.g. serverless-lab</span></span><br>
  <br>
  </p>
  </td>
 </tr>
</table>

<h1><a name="_Toc502863958">Debugging and Monitoring your function</a></h1>

<p class=InstructionStep><span style='color:black'>26.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>After a successful deployment, open the AWS
CodeStar project dashboard and copy our <i>Application endpoints </i>location.</p>

<p class=InstructionStep style='text-indent:0in'></p>

<p class=InstructionStep><span style='color:black'>27.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Open up a browser and modify the URL to look
something like this:<br>
<a href="https://xxxx.execute-api.us-east-1.amazonaws.com/Prod/add/2/3">https://xxxx.execute-api.us-east-1.amazonaws.com/Prod/add/2/3</a>
<br>
<br>
Oh no! It looks like we have a bug. On step 19, we tested the Lambda function
add.js in isolation and it performed correctly. However we have not tested the
function integrated with the Amazon API Gateway. Head back to our AWS Cloud9
IDE so we can debug this issue.</p>

<p class=InstructionStep><span style='color:black'>28.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Open add.js and add a breakpoint on line 17
by clicking on the space next to the row number until it is showing a red dot.
Click <b>Run</b> to start our debugging session.</p>

<p class=InstructionStep style='text-indent:0in'></p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><span style='line-height:115%'>&nbsp;</span></p>

<p class=InstructionStep><span style='color:black'>29.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Since the bug only appears when the function
is called by Amazon API Gateway, we will debug our function using a local API
Gateway environment. Enter the following configuration:</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Click on the Debug icon</p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Run on: <i>API Gateway (local)</i></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Function: <i>AddService</i></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>d.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Path:<i> /add/1/2</i></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>e.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Method:<i> GET</i></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:-.25in'><i>f.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></i><span
dir=LTR></span>Click <b>Run</b></p>

<p class=InstructionStep style='margin-left:.75in;text-indent:0in'></p>

<p class=InstructionStep><span style='color:black'>30.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>We should now see the debugger stops at line
17. Observing it closely, we need to make adjustment to line 17 to read from
the correct <span style='font-family:"Andale Mono"'>event</span> object
properties. Make those changes.<br>
<br>
<b>Hint:</b> Watch out for the <a
href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number#Examples">data
types</a>.</p>

<span style='font-size:12.0pt;line-height:115%;font-family:"Arial",sans-serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><span style='line-height:115%'>&nbsp;</span></p>

<p class=InstructionStep><span style='color:black'>31.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Let’s test it again using the command line
this time:<br>
<br>
<span style='font-family:"Andale Mono"'>sam local start-api&amp;</span></p>

<p class=InstructionStep style='text-indent:0in'>Press enter.<br>
<br>
<span style='font-family:"Andale Mono"'>curl http://127.0.0.1:3000/add/25/75</span></p>

<p class=InstructionStep style='text-indent:0in'>We should now receive the
right result <span style='font-family:"Andale Mono"'>{ … &quot;result&quot;:100
… }</span></p>

<p class=InstructionStep><span style='color:black'>32.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Commit our latest changes to AWS CodeCommit
again.<br>
<span style='font-family:"Andale Mono"'>git add -A<br>
git commit -m “Bugfix: Add() now performs correctly on API GW”<br>
git push origin master</span></p>

<p class=InstructionStep><span style='color:black'>33.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Wait for our Continuous Deployment pipeline
to complete, and test it from our live endpoint that looks similar to: <a
href="https://xxxx.execute-api.us-east-1.amazonaws.com/Prod/add/25/75">https://xxxx.execute-api.us-east-1.amazonaws.com/Prod/add/25/75</a> 
</p>

<p class=InstructionStep><span style='color:black'>34.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span><span dir=LTR></span>Congratulations, you have completed the lab.</p>

<h1><a name="_Toc502863959">Clean up</a></h1>

<p class=MsoNormal>After you are done with your lab, head over to the
CloudFormation console (listed under Services) and delete <span
style='font-family:"Andale Mono"'>aws-cloud9-serverless-lab-xxxxxx</span>, <span
style='font-family:"Andale Mono"'>awscodestar-serverless-lab-lambda</span>, and
<span style='font-family:"Andale Mono"'>awscodestar-server-lab stacks</span>.
This will delete all the resources we created during this lab.</p>

<h1><a name="_Toc502863960">Conclusion</a></h1>

<p class=MsoNormal>In this lab you have learned creating end-to-end development
tools using AWS CloudStar, writing your first Serverless microservice using AWS
Lambda and Amazon API Gateway using the AWS Cloud9 IDE.</p>

</div>

</body>

</html>
